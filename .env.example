INPUT_DIR=/srv/nextcloud/night_worker/input
OUTPUT_DIR=/srv/nextcloud/night_worker/output
STATE_DIR=.state
TASK_PROMPT_FILE=task_prompt.txt
POLL_SECONDS=20
MAX_PARALLEL=1

# Local working directory for job data (container writes here, host syncs to Nextcloud)
WORK_DIR=./work

# Local log directory (system log + per-job logs)
LOG_DIR=./logs

# How often to sync iteration logs to Nextcloud during a job (seconds)
LOG_SYNC_SECONDS=10

# Where to sync live iteration logs and status files (Nextcloud-accessible dir)
# Leave empty to disable Nextcloud log sync.
NEXTCLOUD_LOG_DIR=

# Optional: run a host command after each job sync (success or failure).
# Environment available to the command:
# - JOB_ID
# - NC_OUTPUT_DIR
# - NC_LOG_DIR
# Example for host-installed Nextcloud (requires sudoers NOPASSWD for this command):
# POST_SYNC_HOOK_CMD=sudo -n -u www-data php /var/www/nextcloud/occ files:scan --path="edoardo/files/RalphLoop/out" && sudo -n -u www-data php /var/www/nextcloud/occ files:scan --path="edoardo/files/RalphLoop/logs"
POST_SYNC_HOOK_CMD=
POST_SYNC_HOOK_TIMEOUT_SECONDS=180

# What to do with local work dir after job finishes: on_failure (default), always, never
KEEP_WORK_DIR=on_failure
KEEP_FAILED_MARKER=1
STOP_LOOP_ON_JOB_FAILURE=0

# Optional trigger gate: if set, the loop only runs when this file exists.
# Designed for a "drop start.md in jobs volume to start" workflow.
# Example:
# START_TRIGGER_DIR=/mnt/nextcloud-data/edoardo/ralph_loop
# START_TRIGGER_FILE=start.md
START_TRIGGER_DIR=
START_TRIGGER_FILE=

# Persistent trigger gate: if set, the loop runs only when this file's mtime increases
# compared to the last handled run (useful with cron `touch`).
# Example:
# PERSISTENT_TRIGGER_DIR=/mnt/nextcloud-data/edoardo/ralph_loop/in
# PERSISTENT_TRIGGER_FILE=night.md
PERSISTENT_TRIGGER_DIR=
PERSISTENT_TRIGGER_FILE=

# Applies only to START_TRIGGER_FILE (persistent triggers are never deleted)
CONSUME_TRIGGER=1

# Strict mode: enforce exactly 1 zip in INPUT_DIR, and continue from the latest
# <job_id>_vN.zip found in OUTPUT_DIR (so runs can be resumed nightly).
STRICT_SINGLE_ZIP_CONTRACT=0
STRICT_ALLOW_VERSIONED_INPUTS=0

# Worker limits
MAX_ITERATIONS=8
MAX_SECONDS=3600
ITER_TIMEOUT_SECONDS=600
SOFT_STOP_MARGIN_SECONDS=90

# Iteration chaining
# If enabled, each iteration rehydrates from the previous iteration zip and emits:
# - <job_id>_v1.zip, <job_id>_v2.zip, ...
ZIP_CHAIN_MODE=0
NEXT_INSTRUCTION_FILE=next_instruction.txt

# Ralph docs-style defaults
PRD_FILE=PRD.md
PROGRESS_FILE=progress.txt

# Claude CLI integration
CLAUDE_CMD=claude
CLAUDE_ARGS=--print
CLAUDE_INPUT_MODE=stdin
COMPLETE_SIGNAL=RALPH_COMPLETE
MAX_CONSECUTIVE_TRANSIENT_ERRORS=4
TRANSIENT_BACKOFF_SECONDS=20

# docker-compose volume mounts (worker)
# Named volume claude_home:/home/worker is hardcoded in docker-compose.yml (writable).
# CLAUDE_CREDS_VOLUME: bind-mount host .claude credentials into the container.
# Example: CLAUDE_CREDS_VOLUME=/home/you/.claude:/home/worker/.claude
# If using setup-token instead, leave unset (defaults to no-op mount).
CLAUDE_CREDS_VOLUME=
