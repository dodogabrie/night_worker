INPUT_DIR=/srv/nextcloud/night_worker/input
OUTPUT_DIR=/srv/nextcloud/night_worker/output
STATE_DIR=.state
TASK_PROMPT_FILE=task_prompt.txt
POLL_SECONDS=20
MAX_PARALLEL=1

# Optional trigger gate: if set, the loop only runs when this file exists.
# Designed for a "drop start.md in jobs volume to start" workflow.
# Example:
# START_TRIGGER_DIR=/mnt/nextcloud-data/edoardo/ralph_loop
# START_TRIGGER_FILE=start.md
START_TRIGGER_DIR=
START_TRIGGER_FILE=

# Persistent trigger gate: if set, the loop runs only when this file's mtime increases
# compared to the last handled run (useful with cron `touch`).
# Example:
# PERSISTENT_TRIGGER_DIR=/mnt/nextcloud-data/edoardo/ralph_loop/in
# PERSISTENT_TRIGGER_FILE=night.md
PERSISTENT_TRIGGER_DIR=
PERSISTENT_TRIGGER_FILE=

# Applies only to START_TRIGGER_FILE (persistent triggers are never deleted)
CONSUME_TRIGGER=1

# Strict mode: enforce exactly 1 zip in INPUT_DIR, and continue from the latest
# <job_id>_vN.zip found in OUTPUT_DIR (so runs can be resumed nightly).
STRICT_SINGLE_ZIP_CONTRACT=0
STRICT_ALLOW_VERSIONED_INPUTS=0

# Where the worker writes job outputs inside the container.
# Default: /job/output (bind-mounted from host OUTPUT_DIR by ralph_loop.py)
# To write directly into the /jobs mount (JOBS_VOLUME) set: WORKER_OUTPUT_DIR=/jobs
# (artifacts will be written to JOBS_VOLUME, not host OUTPUT_DIR)
WORKER_OUTPUT_DIR=/job/output

# Worker limits
MAX_ITERATIONS=8
MAX_SECONDS=3600
ITER_TIMEOUT_SECONDS=600
SOFT_STOP_MARGIN_SECONDS=90

# Iteration chaining
# If enabled, each iteration rehydrates from the previous iteration zip and emits:
# - <job_id>_v1.zip, <job_id>_v2.zip, ...
ZIP_CHAIN_MODE=0
NEXT_INSTRUCTION_FILE=next_instruction.txt

# Ralph docs-style defaults
PRD_FILE=PRD.md
PROGRESS_FILE=progress.txt

# If set, the worker overwrites <job_id>.last.log in this folder each iteration (useful for mobile monitoring)
EXTERNAL_LOG_DIR=

# Claude CLI integration
CLAUDE_CMD=claude
CLAUDE_ARGS=--print
CLAUDE_INPUT_MODE=stdin
COMPLETE_SIGNAL=RALPH_COMPLETE
MAX_CONSECUTIVE_TRANSIENT_ERRORS=4
TRANSIENT_BACKOFF_SECONDS=20

# docker-compose volume mounts (worker)
# Set these to match your environment (examples for production):
# CLAUDE_HOME_VOLUME=claude_home:/home/worker/.claude
# JOBS_VOLUME=/mnt/nextcloud-data/edoardo/ralph_loop:/jobs:ro
# Recommended split mounts (ro input, rw output):
# JOBS_IN_VOLUME=/mnt/nextcloud-data/edoardo/ralph_loop/in:/jobs/in:ro
# JOBS_OUT_VOLUME=/mnt/nextcloud-data/edoardo/ralph_loop/out:/jobs/out
# Optional logs folder (single file updated each iteration):
# JOBS_LOGS_VOLUME=/mnt/nextcloud-data/edoardo/ralph_loop/logs:/jobs/logs
CLAUDE_HOME_VOLUME=claude_home:/home/worker
JOBS_VOLUME=./jobs:/jobs:ro
JOBS_IN_VOLUME=
JOBS_OUT_VOLUME=
JOBS_LOGS_VOLUME=
